apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: strimzi-ephemeral
spec:
  kafka:
    replicas: 3
    image: "strimzi/kafka:latest"
    brokerRackInitImage: "strimzi/kafka-init:latest"
    resources:
      limits:
        memory: "5Gi"
    template:
      pod:
        tolerations:
          - key: "key1"
            operator: "Equal"
            value: "value1"
            effect: "NoSchedule"
          - key: "key2"
            operator: "Equal"
            value: "value2"
            effect: "NoSchedule"
    livenessProbe:
      initialDelaySeconds: 5
      timeoutSeconds: 1
    readinessProbe:
      initialDelaySeconds: 10
      timeoutSeconds: 4
    jvmOptions:
      -Xmx: "4G"
      -Xms: "2G"
      -XX:
        foo: bar
    storage:
      type: persistent-claim
      size: 500Gi
    config:
      min.insync.replicas: 3
    listeners:
      - name: plain
        port: 9092
        type: internal
        tls: false
        authentication:
          type: scram-sha-512
        networkPolicyPeers:
          - podSelector:
              matchLabels:
                app: kafka-consumer
          - podSelector:
              matchLabels:
                app: kafka-producer
          - podSelector:
              matchLabels:
                app: java-kafka-consumer
          - podSelector:
              matchLabels:
                app: java-kafka-producer
          - podSelector:
              matchLabels:
                app: java-kafka-streams
          - podSelector:
              matchLabels:
                app: my-connect
          - podSelector:
              matchLabels:
                app: my-connect-s2i
          - podSelector:
              matchLabels:
                app: my-bridge
      - name: tls
        port: 9093
        type: internal
        tls: true
        authentication:
          type: tls
        networkPolicyPeers:
          - podSelector:
              matchLabels:
                app: kafka-consumer
          - podSelector:
              matchLabels:
                app: kafka-producer
          - podSelector:
              matchLabels:
                app: java-kafka-consumer
          - podSelector:
              matchLabels:
                app: java-kafka-producer
          - podSelector:
              matchLabels:
                app: java-kafka-streams
          - podSelector:
              matchLabels:
                app: my-connect
          - podSelector:
              matchLabels:
                app: my-connect-s2i
          - podSelector:
              matchLabels:
                app: my-bridge
      - name: external
        port: 9094
        type: nodeport
        tls: true
        authentication:
          type: tls
        configuration:
          bootstrap:
            alternativeNames:
            - my-bootstrap-host
            host: my-bootstrap-host
          brokers:
            - broker: 0
              advertisedHost: my-broker-0
              advertisedPort: 10000
              host: my-broker-0
            - broker: 1
              advertisedHost: my-broker-1
              advertisedPort: 10001
              host: my-broker-1
            - broker: 2
              advertisedHost: my-broker-2
              advertisedPort: 10002
              host: my-broker-2
    authorization:
      type: simple
      superUsers:
        - CN=jakub
        - CN=paolo
        - CN=tom
        - CN=stanislav
        - CN=kyle
        - CN=sergey
        - CN=andryi
    metricsConfig:
      type: jmxPrometheusExporter
      valueFrom:
        configMapKeyRef:
          name: my-config-map
          key: my-key
  zookeeper:
    replicas: 3
    image: "strimzi/zookeeper:latest"
    resources:
      limits:
        memory: "512Mi"
    template:
      pod:
        tolerations:
          - key: "key1"
            operator: "Equal"
            value: "value1"
            effect: "NoSchedule"
          - key: "key2"
            operator: "Equal"
            value: "value2"
            effect: "NoSchedule"
    livenessProbe:
      initialDelaySeconds: 5
      timeoutSeconds: 1
    readinessProbe:
      initialDelaySeconds: 10
      timeoutSeconds: 4
    jvmOptions:
      -Xmx: "512Mi"
      -Xms: "512Mi"
    storage:
      type: ephemeral
    metricsConfig:
      type: jmxPrometheusExporter
      valueFrom:
        configMapKeyRef:
          name: my-noexist-config-map
          key: my-key
  entityOperator:
    topicOperator:
      watchedNamespace: my-ns
      reconciliationIntervalSeconds: 60
    userOperator:
      watchedNamespace: my-other-ns
      reconciliationIntervalSeconds: 60
  clusterCa:
    renewalDays: 32
    validityDays: 395
    generateCertificateAuthority: false
    generateSecretOwnerReference: true
  clientsCa:
    renewalDays: 20
    validityDays: 400
    generateCertificateAuthority: false
    generateSecretOwnerReference: true


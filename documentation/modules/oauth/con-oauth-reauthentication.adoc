// Module included in the following assemblies:
//
// assembly-oauth-authentication.adoc

[id='{context}']
= Session re-authentication for Kafka brokers

OAuth 2.0 authentication in Strimzi supports _session re-authentication_, which is part of the Kafka Client libraries. 
This Kafka mechanism is used to enforce the expiry of authenticated sessions between OAuth clients and Kafka brokers after a defined period of time. 
When a session expires, the client immediately starts a new session by reusing the existing connection rather than dropping it.

Session re-authentication is disabled by default. 
To enable and configure it, you set a time value for `maxSecondsWithoutReauthentication` in the `oauth` listener configuration in the `Kafka` custom resource. 
The same property is used to configure session re-authentication for OAUTHBEARER and PLAIN authentication. 
For an example configuration, see xref:proc-oauth-authentication-broker-config-{context}[].

Session re-authentication can be used with _fast local JWT_ or _introspection endpoint_ token validation.

.Client re-authentication

When the broker's authenticated session expires, the client must re-authenticate to the existing session by sending a new, valid access token to the broker, without dropping the connection.

If token validation is successful, a new client session is started using the existing connection.
If the client fails to re-authenticate, the broker will close the connection if further attempts are made to send or receive messages.
Java clients that use Kafka client library 2.2 or later automatically re-authenticate if the re-authentication mechanism is enabled on the broker.

.Differences in session expiry for OAUTHBEARER and PLAIN

There are some differences in how session expiry works when session re-authentication is configured for OAUTHBEARER and PLAIN authentication.

* For OAUTHBEARER, the broker's authenticated session will expire at the configured `maxSecondsWithoutReauthentication`. 
The session will expire earlier if the access token expires before the `maxSecondsWithoutReauthentication`. 
The duration of the access token always take precedence over `maxSecondsWithoutReauthentication`.

* For PLAIN, the broker's authenticated session will expire at the configured `maxSecondsWithoutReauthentication`. 
If `maxSecondsWithoutReauthentication` is not configured, PLAIN clients can remain connected to brokers indefinitely, without needing to re-authenticate.

.Additional resources

* xref:con-oauth-authentication-broker-{context}[]

* xref:proc-oauth-authentication-broker-config-{context}[]

* xref:type-KafkaListenerAuthenticationOAuth-reference[KafkaListenerAuthenticationOAuth schema reference]

* link:https://cwiki.apache.org/confluence/display/KAFKA/KIP-368%3A+Allow+SASL+Connections+to+Periodically+Re-Authenticate[KIP-368^]

// This assembly is included in the following assemblies:
//
// master.adoc

[id='assembly-distributed-tracing-{context}']
= Distributed tracing

{ProductName} provides support for the distributed tracing of transactions between the various components of a typical Kafka architecture. When distributed tracing is set up, producing and consuming messages to and from a Kafka cluster generates __traces__ for different events. For example, traces can be generated when a message is consumed by a consumer and when an offset is written to the consumer offsets log.  



these transactions, known as __traces__, are generated at the different stages that are involved in processing messages 


Messages can be traced:



{ProductName} provides support for the distributed tracing of messages between various components. Messages can be traced:

* From a producer to a Kafka cluster to a consumer.
* From a Kafka cluster to a Kafka Streams application, and back again.
* Between a source and a target Kafka cluster through Kafka Mirror Maker.
* From a Kafka Connect connector (including a Source-to-Image connector) to a Kafka cluster.

You can view and query transactions -- referred to as __traces__ -- in a user interface. Tracing data has many uses, including monitoring the operation of your Kafka cluster and debugging performance issues with target systems and applications.

//screenshot of Jaeger user interface

Producers, consumers, and other Java client applications must be configured for distributed tracing before you can take advantage of distributed tracing in {ProductName}. This process is referred to as __client instrumentation__.

.OpenTracing and Jaeger

Distributed tracing in {ProductName} is based on the emerging {OpenTracingHome} specification and the popular {JaegerHome} tracing system.

* OpenTracing defines APIs that developers can use to __instrument__ their applications -- usually in microservice architectures -- for distributed tracing. It is independent from the tracing system.

* Jaeger is an open source distributed tracing system used for monitoring and troubleshooting microservices-based distributed systems. Jaeger is an implementation of the OpenTracing APIs that developers and administrators can use to visualize, query, filter, and analyze trace data.

{ProductName} uses the https://github.com/opentracing-contrib/java-kafka-client/blob/master/README.md[OpenTracing Apache Kafka Client Instrumentation^] library, which simplifies the instrumentation of Kafka clients for OpenTracing. This library is an example of a __tracer__.

Setting up distributed tracing within {ProductName} consists of several related procedures.

* Initialize a Jaeger tracer in Kafka client applications.

* Instrument producers and consumers for OpenTracing.

* Instrument Kafka Streams for OpenTracing.

* Set up distributed tracing for Mirror Maker and Kafka Connect.

Setting up distributed tracing across process boundaries is outside the scope of this chapter. For more information on this subject, see the https://opentracing.io/guides/java/inject-extract/[OpenTracing documentation].

.Prerequisites

Before you set up distributed tracing, it is helpful to understand:

* The basics of OpenTracing, including key concepts such as traces, spans, and tracers. Refer to the {OpenTracingDocs}.

* The components of the {JaegerArch}. 

include::assembly-setting-up-tracing-kafka-clients.adoc[leveloffset=+1]

include::assembly-instrumenting-kafka-clients-tracers.adoc[leveloffset=+1]

include::assembly-setting-up-tracing-mirror-maker-connect.adoc[leveloffset=+1]
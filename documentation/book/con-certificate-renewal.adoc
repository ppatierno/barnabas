// Module included in the following assemblies:
//
// assembly-security.adoc

[id='con-certificate-renewal-{context}']
= Certificate renewal

CA certificates (cluster CA and clients CA) are only valid for given number of days after they are generated, for auto-generated CA certificates the default is 365 days.
Manually installed CA certificates will come with their own validity period.

When a CA certificate expires certificates signed by it will fail validation, even if they are otherwise valid. This means when a CA certificate is replaced it is also necessary to replace all the certificates previously signed by that CA.

While CA certificates are being replaced it is necessary for peers to trust certificates signed by either the old or the new CA. 
This ensures continued operation of the cluster.

The process for CA certificate renewal is:

. Detect that the current certificate is within `Kafka.tlsVertificates.renewalDays` of running out.

. If `Kafka.tlsCertificates.generateCertificateAuthority` is false then log a warning message that CA certificate expiration is imminent and proceed to the next Step. Otherwise, generate a new CA certificate and add it to the corresponding `Secret` (`<cluster-name>-cluster-ca` for the cluster CA, `<cluster-name>-clients-ca` for the clients CA).

. Restart Zookeeper nodes so that they will trust the new CA certificate

. Restart Kafka brokers so that they will trust the new CA certificate

. Restart the Topic and User operators so that they will trust the new CA certificate

. Generate new client certificates (for Zookeeper nodes, Kafka brokers, and the entity operator) signed by the new CA.

. Perform the same restarts so that clients are using certificates signed by the new CA certificate.

. Remove the old CA certificate from the `Secret`.

. Perform another round of restarts.
